#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—á–µ—Ç–∞ —É–±—ã—Ç–∫–æ–≤ –≤ Grid Trading - –æ—Ç –∫–∞–∫–æ–π —Å—É–º–º—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã
"""

def analyze_loss_calculation():
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã —É–±—ã—Ç–∫–æ–≤ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏
    """
    print("=== –ê–ù–ê–õ–ò–ó –†–ê–°–ß–ï–¢–ê –£–ë–´–¢–ö–û–í –í GRID TRADING ===")
    print()
    
    print("–¢–ï–ö–£–©–ê–Ø –õ–û–ì–ò–ö–ê –í –ö–û–î–ï:")
    print("-" * 40)
    print("1. body_pct = abs(close_p - open_p) / base_price * 100")
    print("   –≥–¥–µ base_price = min(open_p, close_p)")
    print()
    print("2. –ü—Ä–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–µ:")
    print("   actual_loss = body_pct")
    print("   total_long_pnl -= actual_loss")
    print()
    
    print("–ü–†–ò–ú–ï–† –†–ê–°–ß–ï–¢–ê:")
    print("-" * 20)
    open_price = 1.000
    close_price = 0.946  # –ü–∞–¥–µ–Ω–∏–µ –Ω–∞ ~5.4%
    
    base_price = min(open_price, close_price)  # 0.946
    body_pct = abs(close_price - open_price) / base_price * 100
    
    print(f"Open: ${open_price:.3f}")
    print(f"Close: ${close_price:.3f}")
    print(f"base_price (min): ${base_price:.3f}")
    print(f"body_pct: {body_pct:.2f}%")
    print()
    
    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã
    decline_from_open = (open_price - close_price) / open_price * 100
    print(f"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç (–æ—Ç open): {decline_from_open:.2f}%")
    print()
    
    print("–ß–¢–û –≠–¢–û –û–ó–ù–ê–ß–ê–ï–¢ –í –ö–û–ù–¢–ï–ö–°–¢–ï GRID TRADING:")
    print("-" * 50)
    print("‚ùì –ü–†–û–ë–õ–ï–ú–ê: –ü—Ä–æ—Ü–µ–Ω—Ç—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—Ç –¶–ï–ù–´, –∞ –Ω–µ –æ—Ç –ö–ê–ü–ò–¢–ê–õ–ê")
    print()
    print("–í Grid Trading:")
    print("- –£ –Ω–∞—Å –µ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, $1000)")
    print("- –ú—ã —Ä–∞–∑–º–µ—â–∞–µ–º –æ—Ä–¥–µ—Ä–∞ –≤ —Å–µ—Ç–∫–µ")
    print("- –ü—Ä–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–µ –º—ã —Ç–µ—Ä—è–µ–º —á–∞—Å—Ç—å –ö–ê–ü–ò–¢–ê–õ–ê, –∞ –Ω–µ —Ü–µ–Ω—ã")
    print()
    
    print("–ü–†–ò–ú–ï–† –° –ö–ê–ü–ò–¢–ê–õ–û–ú:")
    print("-" * 25)
    initial_capital = 1000  # $1000 –∫–∞–ø–∏—Ç–∞–ª
    grid_investment_per_side = 500  # $500 –Ω–∞ –∫–∞–∂–¥—É—é —Å–µ—Ç–∫—É
    
    print(f"–ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª: ${initial_capital}")
    print(f"–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ Long —Å–µ—Ç–∫—É: ${grid_investment_per_side}")
    print()
    
    # –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã –Ω–∞ 5.4%
    price_decline_pct = 5.4
    
    # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Ç–µ—Ä–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç:
    # 1. –°–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –±—ã–ª–æ –æ—Ç–∫—Ä—ã—Ç–æ
    # 2. –ù–∞ –∫–∞–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö –æ–Ω–∏ –±—ã–ª–∏ –æ—Ç–∫—Ä—ã—Ç—ã
    # 3. –°–∫–æ–ª—å–∫–æ –∫–∞–ø–∏—Ç–∞–ª–∞ –±—ã–ª–æ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–æ
    
    print("–†–ï–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –£–ë–´–¢–ö–û–í:")
    print("–ï—Å–ª–∏ —Ü–µ–Ω–∞ —É–ø–∞–ª–∞ –Ω–∞ 5.4%, —Ç–æ —É–±—ã—Ç–æ–∫ Long —Å–µ—Ç–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:")
    print("1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö Long –ø–æ–∑–∏—Ü–∏–π")
    print("2. –°—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤—Ö–æ–¥–∞")
    print("3. –†–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π")
    print()
    
    # –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    avg_entry_level = 0.98  # –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—Ö–æ–¥–∞ (2% –Ω–∏–∂–µ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã)
    current_price = 0.946
    position_size = 300  # $300 –≤ Long –ø–æ–∑–∏—Ü–∏—è—Ö
    
    real_loss_pct = (avg_entry_level - current_price) / avg_entry_level * 100
    real_loss_amount = position_size * (real_loss_pct / 100)
    capital_loss_pct = real_loss_amount / initial_capital * 100
    
    print(f"–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞:")
    print(f"- –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—Ö–æ–¥–∞: ${avg_entry_level:.3f}")
    print(f"- –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: ${current_price:.3f}")
    print(f"- –£–±—ã—Ç–æ–∫ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º: {real_loss_pct:.2f}%")
    print(f"- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π: ${position_size}")
    print(f"- –£–±—ã—Ç–æ–∫ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö: ${real_loss_amount:.2f}")
    print(f"- –£–±—ã—Ç–æ–∫ –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞: {capital_loss_pct:.2f}%")
    print()

def analyze_current_implementation():
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ –∫–æ–¥–µ
    """
    print("=== –ü–†–û–ë–õ–ï–ú–´ –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò ===")
    print()
    
    print("üö® –ü–†–û–ë–õ–ï–ú–ê 1: –ù–ï–ö–û–†–†–ï–ö–¢–ù–ê–Ø –ë–ê–ó–ê –†–ê–°–ß–ï–¢–ê")
    print("- body_pct —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Ü–µ–Ω—ã —Å–≤–µ—á–∏")
    print("- total_long_pnl -= body_pct –≤—ã—á–∏—Ç–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —Ü–µ–Ω—ã")
    print("- –ù–û total_long_pnl –∞–∫–∫—É–º—É–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞")
    print("- –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –±–∞–∑ —Ä–∞—Å—á–µ—Ç–∞!")
    print()
    
    print("üö® –ü–†–û–ë–õ–ï–ú–ê 2: –ù–ï–Ø–°–ù–ê–Ø –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–Ø")
    print("- –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç 'Long –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: 536.30%'?")
    print("- 536% –æ—Ç –∫–∞–∫–æ–π —Å—É–º–º—ã?")
    print("- –û—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞? –û—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—É–º–º—ã?")
    print()
    
    print("üö® –ü–†–û–ë–õ–ï–ú–ê 3: –ù–ê–ö–û–ü–õ–ï–ù–ò–ï –ë–ï–ó –ë–ê–ó–´")
    print("- total_long_pnl += long_wick_profit")
    print("- long_wick_profit = trades * (grid_step - commission)")
    print("- –ù–æ –Ω–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ä–∞–∑–º–µ—Ä—É –∫–∞–ø–∏—Ç–∞–ª–∞ –∏–ª–∏ –ø–æ–∑–∏—Ü–∏–π")
    print()

def recommend_fixes():
    """
    –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
    """
    print("=== –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ ===")
    print()
    
    print("üí° –†–ï–®–ï–ù–ò–ï 1: –û–ü–†–ï–î–ï–õ–ò–¢–¨ –ë–ê–ó–£ –†–ê–°–ß–ï–¢–ê")
    print("- –ß–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å: –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —á–µ–≥–æ —Å—á–∏—Ç–∞—é—Ç—Å—è")
    print("- –ù–∞–ø—Ä–∏–º–µ—Ä: '–æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ $1000'")
    print("- –ò–ª–∏: '–æ—Ç —Å—É–º–º—ã, –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—É—é —Å–µ—Ç–∫—É'")
    print()
    
    print("üí° –†–ï–®–ï–ù–ò–ï 2: –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø –ö –ö–ê–ü–ò–¢–ê–õ–£")
    print("- –í–≤–µ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä initial_capital")
    print("- –í—Å–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Å—á–∏—Ç–∞—Ç—å –æ—Ç —ç—Ç–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞")
    print("- –ü—Ä–∏–º–µ—Ä: 5% –æ—Ç $1000 = $50 —É–±—ã—Ç–∫–∞")
    print()
    
    print("üí° –†–ï–®–ï–ù–ò–ï 3: –£–¢–û–ß–ù–ò–¢–¨ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ")
    print("- –î–æ–±–∞–≤–∏—Ç—å –ø–æ—è—Å–Ω–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    print("- '–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —É—Å–ª–æ–≤–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ $1000'")
    print("- –ò–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –∞–∫—Ç–∏–≤–∞")
    print()
    
    print("–ü–†–ò–ú–ï–† –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ö–û–î–ê:")
    print("-" * 30)
    print("# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑—É —Ä–∞—Å—á–µ—Ç–∞")
    print("BASE_CAPITAL = 1000  # $1000 —É—Å–ª–æ–≤–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª")
    print("GRID_ALLOCATION = 0.5  # 50% –Ω–∞ –∫–∞–∂–¥—É—é —Å–µ—Ç–∫—É")
    print()
    print("# –ü—Ä–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–µ")
    print("price_decline_pct = body_pct")
    print("allocated_capital = BASE_CAPITAL * GRID_ALLOCATION")
    print("loss_amount = allocated_capital * (price_decline_pct / 100)")
    print("loss_as_pct_of_total = loss_amount / BASE_CAPITAL * 100")
    print("total_long_pnl -= loss_as_pct_of_total")

if __name__ == "__main__":
    analyze_loss_calculation()
    print()
    analyze_current_implementation()
    print()
    recommend_fixes()
