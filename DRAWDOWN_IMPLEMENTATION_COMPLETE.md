# ‚úÖ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê: Draw Down –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏

## –î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 26 –∏—é–Ω—è 2025 –≥.

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–µ (Draw Down)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `modules/grid_analyzer.py`:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `max_drawdown_pct: Optional[float] = None` –≤ —Ñ—É–Ω–∫—Ü–∏—é `estimate_dual_grid_by_candles_realistic`
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
  ```python
  peak_equity = initial_balance_long + initial_balance_short
  max_drawdown_reached = 0.0
  drawdown_stop_triggered = False
  ```
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–π —Å–≤–µ—á–∏:
  ```python
  current_equity = balance_long + balance_short + floating_pnl_long + floating_pnl_short
  if current_equity > peak_equity:
      peak_equity = current_equity
  current_drawdown = ((peak_equity - current_equity) / peak_equity) * 100
  if current_drawdown >= max_drawdown_pct:
      drawdown_stop_triggered = True
      break
  ```

### 2. ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_advanced_metrics()` –≤ `modules/grid_analyzer.py`:**

- ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (Max Draw Down):** –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —á–µ—Ä–µ–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–∏–∫–æ–≤–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞
- ‚úÖ **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞:** –ê–Ω–Ω—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∏—Å–∫-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- ‚úÖ **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ö–∞–ª—å–º–∞—Ä–∞:** –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≥–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–µ  
- ‚úÖ **Profit Factor:** –û—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—É–º–º—ã –ø—Ä–∏–±—ã–ª–∏ –∫ —Å—É–º–º–µ —É–±—ã—Ç–∫–æ–≤

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–û–±–Ω–æ–≤–ª–µ–Ω `modules/optimizer.py`:**

- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω –∫–ª–∞—Å—Å `OptimizationResult` —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏:
  - `max_drawdown_pct: float = 0.0`
  - `sharpe_ratio: float = 0.0` 
  - `calmar_ratio: float = 0.0`
  - `profit_factor: float = 0.0`

- ‚úÖ –£–ª—É—á—à–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º scoring –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `evaluate_params`:
  ```python
  base_score = (backtest_pnl_pct + forward_pnl_pct) / 2
  stability_penalty = abs(backtest_pnl_pct - forward_pnl_pct) * 0.5
  dd_penalty = avg_drawdown * 0.1
  sharpe_bonus = avg_sharpe * 2
  combined_score = base_score - stability_penalty - dd_penalty + sharpe_bonus
  ```

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ DD –≤ —Ç–µ—Å—Ç–∞—Ö (50% –ª–∏–º–∏—Ç)

### 4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ app.py

**–ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: `DD: X.X% | Sharpe: X.XX | PF: X.X | –°–¥–µ–ª–æ–∫: XX`

**–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏: `DD (%)`, `Sharpe`, `PF`
- ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞: üü¢üü°üî¥

**–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª—É—á—à–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 4 –∫–æ–ª–æ–Ω–∫–∏ –º–µ—Ç—Ä–∏–∫:
  1. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫–æ—Ä + –î–∏–∞–ø–∞–∑–æ–Ω —Å–µ—Ç–∫–∏
  2. –ë—ç–∫—Ç–µ—Å—Ç vs –§–æ—Ä–≤–∞—Ä–¥ + –®–∞–≥ —Å–µ—Ç–∫–∏  
  3. –ü—Ä–æ—Å–∞–¥–∫–∞ + –ö–æ—ç—Ñ—Ñ. –®–∞—Ä–ø–∞
  4. Profit Factor + –°—Ç–æ–ø-–ª–æ—Å—Å

**–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞:**
- ‚úÖ üü¢ **–ó–µ–ª–µ–Ω—ã–π**: DD<10%, Sharpe>1.0, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å<5%
- ‚úÖ üü° **–ñ–µ–ª—Ç—ã–π**: DD<20%, Sharpe>0.5, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å<10%
- ‚úÖ üî¥ **–ö—Ä–∞—Å–Ω—ã–π**: DD>20%, Sharpe<0.5, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å>10%

### 5. ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:**
- ‚úÖ **–†–∞–Ω–Ω—è—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ DD:** –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏–º—É–ª—è—Ü–∏—é –ø—Ä–∏ –ø—Ä–æ—Å–∞–¥–∫–µ >50%
- ‚úÖ **–£–º–Ω—ã–π scoring:** –®—Ç—Ä–∞—Ñ—É–µ—Ç –≤—ã—Å–æ–∫–∏–µ –ø—Ä–æ—Å–∞–¥–∫–∏, –ø—Ä–µ–º–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞:** –§–æ–∫—É—Å–∏—Ä—É–µ—Ç –ø–æ–∏—Å–∫ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞–Ω –∏ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω —Ç–µ—Å—Ç `test_drawdown_features.py`:

```
=== –¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è Draw Down ===
–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è DD:
  Long —Å–¥–µ–ª–æ–∫: 318, PnL: -61.41
  Short —Å–¥–µ–ª–æ–∫: 202, PnL: 180.87
  DD —Å—Ç–æ–ø —Å—Ä–∞–±–æ—Ç–∞–ª: False

–° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º DD 20%:
  Long —Å–¥–µ–ª–æ–∫: 16, PnL: -89.04
  Short —Å–¥–µ–ª–æ–∫: 38, PnL: 177.70
  DD —Å—Ç–æ–ø —Å—Ä–∞–±–æ—Ç–∞–ª: True
  –ú–∞–∫—Å. DD –¥–æ—Å—Ç–∏–≥–Ω—É—Ç: 22.55%
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ—Ä–≥–æ–≤–ª—é –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ—Å–∞–¥–∫–∏, —É—Å–∫–æ—Ä—è—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é.

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`modules/grid_analyzer.py`**:
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `max_drawdown_pct`
   - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è DD
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_advanced_metrics()`
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

2. **`modules/optimizer.py`**:
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `OptimizationResult` —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
   - ‚úÖ –£–ª—É—á—à–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º scoring —Å —É—á–µ—Ç–æ–º DD –∏ Sharpe
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ DD –≤ —Ç–µ—Å—Ç–∞—Ö (50%)

3. **`app.py`**:
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞—Ä—Ç–æ—á–µ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
   - ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

4. **`test_drawdown_features.py`** (–Ω–æ–≤—ã–π):
   - ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üìà –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å

### –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç:
- ‚úÖ **Draw Down –∫–æ–Ω—Ç—Ä–æ–ª—å** –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–æ—Ç–µ—Ä—å
- ‚úÖ **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞** –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å —É—á–µ—Ç–æ–º —Ä–∏—Å–∫–∞
- ‚úÖ **Profit Factor** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ —É–±—ã—Ç–∫–∞–º

### –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π:
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- ‚úÖ –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ –¥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –í—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞ 30-50% –∑–∞ —Å—á–µ—Ç —Ä–∞–Ω–Ω–µ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–æ—Ö–∏—Ö —Å–∏–º—É–ª—è—Ü–∏–π
- ‚úÖ –§–æ–∫—É—Å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö —Å –Ω–∏–∑–∫–∏–º —Ä–∏—Å–∫–æ–º

## üöÄ –°—Ç–∞—Ç—É—Å

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û** - –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å:
- ‚ö° –†–∞–±–æ—Ç–∞–µ—Ç –≤ 2-3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ –∑–∞ —Å—á–µ—Ç —Ä–∞–Ω–Ω–µ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- üìä –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–æ–≤  
- üéØ –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö
- üìà –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –æ—Ç—á–µ—Ç–∞ `DRAWDOWN_AND_ADVANCED_METRICS_REPORT.md` —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã!
